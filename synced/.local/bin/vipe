#!/bin/bash

# if running inside other vim/nvim instances
VIMRUNTIME=""
VIM=""

tempfile="$(mktemp)"
touch "$tempfile"

if [[ ! -t 0 ]]; then
    cat >"$tempfile"
fi

if bash -c ">/dev/tty" >/dev/null 2>/dev/null; then
    # /dev/tty is available / writable
    vim "$@" "$tempfile" >/dev/tty </dev/tty
else
    vim "$@" "$tempfile"
fi
vim_status="$?"

if [[ "$vim_status" != 0 ]]; then
    rm "$tempfile"
    exit "$vim_status"
fi

cat "$tempfile"

rm "$tempfile"
